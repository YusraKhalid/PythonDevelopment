<!-- Dropdown Structure -->
{% block navbar%}

<ul id="settings_dropdown" class="dropdown-content">
  <li><a href="/user/settings">Profile</a></li>
  <li class="divider"></li>
  <li><a href="/auth/logout">Logout</a></li>
</ul>

<div class="navbar-fixed">
  <nav>
    <div class="nav-wrapper teal">
      <a href="/" class="brand-logo">Job Chercher</a>
      <ul class="right hide-on-med-and-down">
        {% if not user.is_authenticated %}
        <li><a href="/auth/signin">Sign In</a></li>
        <li><a href="/auth/signup">Sign Up</a></li>
        {% else %}
        <li>
          {% if user.is_seller %}
          <a href="/" id="switch-buying-link">Switch to Buying</a>
          {% else %}
          <a href="/seller" id="switch-selling-link">Switch to Selling</a>
        </li>
        {% endif %}

        <li>

          <a class="dropdown-trigger" data-target="settings_dropdown"
            >
            {% if user.profile.profile_image %}
            <div class="center-flex-row" >
                <div style="width:30px; height: 30px; margin-bottom: 10px;">
                    <img class="responsive-img circle" src="{{ user.profile.profile_image.url}}" alt="{{ user }}"  style="width: 100%; height: 100%">
                </div>
                <h6 class="m-5">{{ user.first_name | add:" " | add:user.last_name }}</h6>
                <i class="material-icons right">arrow_drop_down</i>
              </div>
              
            {% endif %}
            </a>
        </li>
        {% endif %}
      </ul>
    </div>
  </nav>
</div>
{% endblock %}

<script>
  $(document).ready(function() {
    $("#switch-selling-link").click(function(event) {
      event.preventDefault();
      var redirectUrl = $(this).attr("href");
      change_role("seller", redirectUrl);
    });
    $("#switch-buying-link").click(function(event) {
      event.preventDefault();
      var redirectUrl = $(this).attr("href");
      change_role("buyer", redirectUrl);
    });
  });

  function change_role(userRole, redirectUrl) {
    $.ajax({
      url: "http://localhost:8000/auth/change_role/",
      data: {
        role: userRole
      },
      complete: function() {
        window.location.href = redirectUrl;
      }
    });
  }
</script>
