<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wheels | Index</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <style>
        * {
          box-sizing: border-box;
        }

        body {
          font: 16px Arial;
        }

        .autocomplete {
          position: relative;
          display: inline-block;
        }

        input {
          border: 1px solid transparent;
          background-color: #f1f1f1;
          padding: 10px;
          font-size: 16px;
        }

        input[type=text] {
          background-color: #f1f1f1;
          width: 100%;
        }

        input[type=submit] {
          background-color: DodgerBlue;
          color: #fff;
          cursor: pointer;
        }

        .autocomplete-items {
          position: absolute;
          border: 1px solid #d4d4d4;
          border-bottom: none;
          border-top: none;
          z-index: 99;
          top: 100%;
          left: 0;
          right: 0;
        }

        .autocomplete-items div {
          padding: 10px;
          cursor: pointer;
          background-color: #fff;
          border-bottom: 1px solid #d4d4d4;
        }

        .autocomplete-items div:hover {
          background-color: #e9e9e9;
        }

        .autocomplete-active {
          background-color: DodgerBlue !important;
          color: #ffffff;
        }
    </style>
</head>
<body>
<!--    <div id="data_in"></div>-->
    <button class="btn btn-outline-primary" type="button" onclick="showData()">Show Data</button>
    <button class="btn btn-outline-info" type="button" onclick="hideData()">Hide Data</button>

    <div class="autocomplete" style="width:300px;">
        <input id="make" type="text" placeholder="Make" maxlength="10" onkeyup="filterUsedCars(this.value, 0)">
    </div>
    <div class="autocomplete" style="width:300px;">
         <input id="model" type="text" placeholder="Model" onkeyup="filterUsedCars(this.value, 1)">
    </div>
    <div class="autocomplete" style="width:300px;">
        <input id="city" type="text" placeholder="City" maxlength="10" onkeyup="filterUsedCars(this.value, 5)">
    </div>
    <div class="autocomplete" style="width:300px;">
         <input id="year" type="number" max="2020" min="1970" placeholder="Year" onkeyup="filterUsedCars(this.value, 2)">
    </div>

    <table class="table table-bordered" >
      <thead class="thead-dark">
        <tr>
          <th>Make</th>
          <th>Model</th>
          <th>Year</th>
          <th>Millage</th>
          <th>Transmission</th>
          <th>Register City</th>
          <th>Assembly</th>
          <th>Body Type</th>
          <th>Engine Type</th>
          <th>Engine Capacity</th>
          <th>Features</th>
          <th>Description</th>
          <th>Image</th>
        </tr>
      </thead>
      <tbody id="UsedCars" class="collapse show">
        <!-- Data from JS will be added here       -->
      </tbody>
    </table>

<script type="text/javascript">
        let used_car = [];
        let temp_var = {};
        {% for car in wheels %}
        temp_var = {
                    'make': "{{ car.make }}",
                    "model": "{{ car.carmodel }}",
                    "year": {{ car.year }},
                    'millage': "{{ car.millage }}",
                    'transmission': "{{ car.transmission }}",
                    'reg_city': "{{ car.reg_city }}",
                    'assembly': "{{ car.assembly }}",
                    'body_type': "{{ car.body_type }}",
                    'engine_type': "{{ car.engine_type }}",
                    'engine_capacity': "{{ car.engine_capacity }}",
                    'features': "{{ car.features }}",
                    'description': "{{ car.description }}",
                    'image': "{{ car.image }}"
                    };
        used_car.push(temp_var);
        {% endfor %}

        let is_data_present = false;
        function showData()
        {
            if(!is_data_present)
            {
                let table = document.getElementById('UsedCars');
                let row, cell;
                for(let i=0; i<used_car.length; i++)
                {
                    row = table.insertRow(i);

                    cell = row.insertCell(0);
                    cell.innerHTML = used_car[i].make;

                    cell = row.insertCell(1);
                    cell.innerHTML = used_car[i].model;

                    cell = row.insertCell(2);
                    cell.innerHTML = used_car[i].year;

                    cell = row.insertCell(3);
                    cell.innerHTML = used_car[i].millage;

                    cell = row.insertCell(4);
                    cell.innerHTML = used_car[i].transmission;

                    cell = row.insertCell(5);
                    cell.innerHTML = used_car[i].reg_city;

                    cell = row.insertCell(6);
                    cell.innerHTML = used_car[i].assembly;

                    cell = row.insertCell(7);
                    cell.innerHTML = used_car[i].body_type;

                    cell = row.insertCell(8);
                    cell.innerHTML = used_car[i].engine_type;

                    cell = row.insertCell(9);
                    cell.innerHTML = used_car[i].engine_capacity;

                    cell = row.insertCell(10);
                    cell.innerHTML = used_car[i].features;

                    cell = row.insertCell(11);
                    cell.innerHTML = used_car[i].description;

                    cell = row.insertCell(12);
                    cell.innerHTML = "<a href=" + used_car[i].image + " target='_blank'>Image Link</a>";
                }
                is_data_present = true;
            }
            else
            {
                document.getElementById("UsedCars").style.display = "";
            }
        }

        function hideData()
        {
            document.getElementById("UsedCars").style.display = "none";
        }

        function filterUsedCars(input, ith_cell)
        {
            if(is_data_present && input)
            {
                let filter, table, tr, td, i, txtValue;

                filter = input.toUpperCase();
                table = document.getElementById("UsedCars");
                tr = table.getElementsByTagName("tr");

                for (i = 0; i < tr.length; i++)
                {
                    td = tr[i].getElementsByTagName("td")[ith_cell];
                    if (td)
                    {
                        txtValue = td.textContent;
                        if (txtValue.toUpperCase().indexOf(filter) > -1)
                        {
                            tr[i].style.display = "";
                        }
                        else
                        {
                            tr[i].style.display = "none";
                        }
                    }
                }
            }
        }


        // this is a third party function
        function autocomplete(inp, arr)
        {
          let currentFocus;
          inp.addEventListener("input", function(e)
          {
              let list_ele, in_tag_val, i, val = this.value;
              closeAllLists();
              if (!val) { return false;}
              currentFocus = -1;
              list_ele = document.createElement("DIV");
              list_ele.setAttribute("id", this.id + "autocomplete-list");
              list_ele.setAttribute("class", "autocomplete-items");
              this.parentNode.appendChild(list_ele);
              for (i = 0; i < arr.length; i++) {
                if (arr[i].substr(0, val.length).toUpperCase() === val.toUpperCase()) {

                  in_tag_val = document.createElement("DIV");

                  in_tag_val.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                  in_tag_val.innerHTML += arr[i].substr(val.length);
                  in_tag_val.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";

                  in_tag_val.addEventListener("click", function(e) {

                      inp.value = this.getElementsByTagName("input")[0].value;
                      closeAllLists();
                  });
                  list_ele.appendChild(in_tag_val);
                }
              }
          });

          inp.addEventListener("keydown", function(e)
          {
              let x = document.getElementById(this.id + "autocomplete-list");
              if (x) x = x.getElementsByTagName("div");
              if (e.keyCode === 40) {


                currentFocus++;

                addActive(x);
              } else if (e.keyCode === 38) { //up


                currentFocus--;
                addActive(x);
              } else if (e.keyCode === 13) {
                e.preventDefault();
                if (currentFocus > -1) {
                  if (x) x[currentFocus].click();
                }
              }
          });

          function addActive(x)
          {

            if (!x) return false;
            removeActive(x);
            if (currentFocus >= x.length) currentFocus = 0;
            if (currentFocus < 0) currentFocus = (x.length - 1);
            x[currentFocus].classList.add("autocomplete-active");
          }

          function removeActive(x)
          {

            for (let i = 0; i < x.length; i++) {
              x[i].classList.remove("autocomplete-active");
            }
          }

          function closeAllLists(elmnt)
          {

            let x = document.getElementsByClassName("autocomplete-items");
            for (let i = 0; i < x.length; i++) {
              if (elmnt !== x[i] && elmnt !== inp) {
                x[i].parentNode.removeChild(x[i]);
              }
            }
          }
          document.addEventListener("click", function (e)
          {
              closeAllLists(e.target);
          });
        }

        let cities = new Set();
        let makes = new Set();
        let models = new Set();

        for(let i=0; i<used_car.length; i++)
        {
            cities.add(used_car[i].reg_city);
            makes.add(used_car[i].make);
            models.add(used_car[i].model);
        }

        cities = [...cities];
        makes = [...makes];
        models = [...models];

        autocomplete(document.getElementById("city"), cities);
        autocomplete(document.getElementById("make"), makes);
        autocomplete(document.getElementById("model"), models);
</script>

</body>
</html>
